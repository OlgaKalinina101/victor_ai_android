# –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

## –û–±–∑–æ—Ä

–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–ª–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —ç–∫—Ä–∞–Ω —Å –∑–∞–ø—Ä–æ—Å–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –§–∞–π–ª—ã

1. **PermissionModels.kt** - –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
   - `PermissionItem` - –º–æ–¥–µ–ª—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è UI
   - `PermissionType` - enum —Ç–∏–ø–æ–≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

2. **PermissionsScreen.kt** - UI —ç–∫—Ä–∞–Ω–∞
   - –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
   - –ö–Ω–æ–ø–∫–∏ "–†–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å—ë" / "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤—Å–µ—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

3. **PermissionsViewModel.kt** - –ª–æ–≥–∏–∫–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
   - –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Intent –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

4. **UserProvider.kt** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
   - `AuthState.NeedsPermissions` - –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
   - `moveToPermissionsScreen()` - –ø–µ—Ä–µ—Ö–æ–¥ –∫ —ç–∫—Ä–∞–Ω—É
   - `completePermissions()` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - –§–ª–∞–≥ `KEY_PERMISSIONS_COMPLETED` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ SharedPreferences

5. **MainActivity.kt** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ `AuthState.NeedsPermissions`
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ `PermissionsScreen`

## –†–∞–∑—Ä–µ—à–µ–Ω–∏—è

### –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ (—Ç—Ä–µ–±—É—é—Ç –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

1. **üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω** (`RECORD_AUDIO`)
   - "—á—Ç–æ–±—ã —è –º–æ–≥ —Å–ª—ã—à–∞—Ç—å —Ç–≤–æ–π –≥–æ–ª–æ—Å –∏ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –Ω–µ–≥–æ"

2. **üìç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è** (`ACCESS_FINE_LOCATION`, `ACCESS_COARSE_LOCATION`)
   - "—á—Ç–æ–±—ã —è –º–æ–≥ —Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–≥–æ–¥—É –∏ –≥—É–ª—è—Ç—å —Å —Ç–æ–±–æ–π –ø–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º"

3. **üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** (`POST_NOTIFICATIONS`, Android 13+)
   - "—á—Ç–æ–±—ã –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å –æ –≤–∞–∂–Ω—ã—Ö –¥–µ–ª–∞—Ö –∏ —Å–æ–±—ã—Ç–∏—è—Ö"

4. **‚è∞ –ë—É–¥–∏–ª—å–Ω–∏–∫** (`SCHEDULE_EXACT_ALARM`, `USE_EXACT_ALARM`)
   - "—á—Ç–æ–±—ã –º–æ–≥ –±—É–¥–∏—Ç—å —Ç–µ–±—è –ø–æ —É—Ç—Ä–∞–º –≤ —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è"

5. **üì± –í—Å–ø–ª—ã–≤–∞—é—â–∏–µ –æ–∫–Ω–∞** (`SYSTEM_ALERT_WINDOW`)
   - "—á—Ç–æ–±—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –±—É–¥–∏–ª—å–Ω–∏–∫ –ø–æ–≤–µ—Ä—Ö –¥—Ä—É–≥–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"

6. **üîã –†–∞–±–æ—Ç–∞ –≤ —Ñ–æ–Ω–µ** (`REQUEST_IGNORE_BATTERY_OPTIMIZATIONS`)
   - "—á—Ç–æ–±—ã –±—É–¥–∏–ª—å–Ω–∏–∫–∏ –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞–ª–∏, –¥–∞–∂–µ –∫–æ–≥–¥–∞ —ç–∫—Ä–∞–Ω –≤—ã–∫–ª—é—á–µ–Ω"

7. **üì∏ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏** (`READ_MEDIA_IMAGES` / `READ_EXTERNAL_STORAGE`)
   - "—á—Ç–æ–±—ã —Ç—ã –º–æ–≥ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–Ω–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤ —á–∞—Ç–µ"

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ (–Ω–µ —Ç—Ä–µ–±—É—é—Ç –∑–∞–ø—Ä–æ—Å–∞)

- `INTERNET`
- `ACCESS_NETWORK_STATE`
- `VIBRATE`
- `RECEIVE_BOOT_COMPLETED`
- `WAKE_LOCK`
- `FOREGROUND_SERVICE`
- `FOREGROUND_SERVICE_MEDIA_PLAYBACK`
- `USE_FULL_SCREEN_INTENT`
- `ACCESS_WIFI_STATE`, `CHANGE_WIFI_STATE`

## –§–ª–æ—É

### –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

```
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -> submitRegistration() 
            -> AuthState.NeedsPermissions 
            -> PermissionsScreen
            -> completePermissions() 
            -> AuthState.Ok 
            -> MainScreen
```

### –ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```
–°—Ç–∞—Ä—Ç -> resolveOnStartup() 
      -> –ø—Ä–æ–≤–µ—Ä–∫–∞ KEY_PERMISSIONS_COMPLETED
      -> –µ—Å–ª–∏ false: AuthState.NeedsPermissions -> PermissionsScreen
      -> –µ—Å–ª–∏ true: AuthState.Ok -> MainScreen
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–∂–∞—Ç—å "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å" - —Ñ–ª–∞–≥ `KEY_PERMISSIONS_COMPLETED` –≤—Å—ë —Ä–∞–≤–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –∏ —ç–∫—Ä–∞–Ω –±–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è.

### –°–±—Ä–æ—Å–∏—Ç—å —Ñ–ª–∞–≥ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```kotlin
// –û—á–∏—Å—Ç–∏—Ç—å —Ñ–ª–∞–≥ —á–µ—Ä–µ–∑ SharedPreferences
context.getSharedPreferences("victor_ai_auth", Context.MODE_PRIVATE)
    .edit()
    .remove("permissions_completed")
    .apply()
```

## TODO

- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π —á–µ—Ä–µ–∑ `ActivityResultContract` –≤ MainActivity
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

