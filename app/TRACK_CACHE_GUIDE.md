# üéµ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—é —Ç—Ä–µ–∫–æ–≤

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–µ–∫–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å –º—É–∑—ã–∫—É –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –¥–ª—è –æ—Ñ–ª–∞–π–Ω-–ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–∞—Ç—Ç–µ—Ä–Ω **offline-first** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Ä–∞–∑–º–µ—Ä–æ–º –∫–µ—à–∞.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
UI Layer (Playlist)
      ‚Üì
PlaylistViewModel
      ‚Üì
TrackCacheRepository ‚Üê —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º
      ‚Üì
TrackCacheDao ‚Üê Room Database
      ‚Üì
Local Storage (—Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞)
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. TrackCacheEntity
**–ü—É—Ç—å:** `data/local/entity/TrackCacheEntity.kt`

Room entity –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–∞—Ö:
- `trackId` - ID —Ç—Ä–µ–∫–∞ (–ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á)
- `localPath` - –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
- `fileSize` - —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö
- `cachedAt` - –¥–∞—Ç–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è (timestamp)
- `title`, `artist` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

### 2. TrackCacheDao
**–ü—É—Ç—å:** `data/local/dao/TrackCacheDao.kt`

DAO –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–µ—à–µ–º:
```kotlin
// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∏ (—Ä–µ–∞–∫—Ç–∏–≤–Ω–æ)
fun getAllCachedTracks(): Flow<List<TrackCacheEntity>>

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω –ª–∏ —Ç—Ä–µ–∫
suspend fun getCachedTrack(trackId: Int): TrackCacheEntity?

// –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫ –≤ –∫–µ—à
suspend fun insertCachedTrack(track: TrackCacheEntity)

// –£–¥–∞–ª–∏—Ç—å —Ç—Ä–µ–∫ –∏–∑ –∫–µ—à–∞
suspend fun deleteCachedTrack(trackId: Int)

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
suspend fun getCachedCount(): Int
suspend fun getTotalCacheSize(): Long?
```

### 3. TrackCacheRepository
**–ü—É—Ç—å:** `data/repository/TrackCacheRepository.kt`

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º:

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
```kotlin
// –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–∫
suspend fun cacheTrack(track: Track, serverUrl: String): Result<String>

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω –ª–∏ —Ç—Ä–µ–∫
suspend fun isCached(trackId: Int): Boolean

// –ü–æ–ª—É—á–∏—Ç—å –ø—É—Ç—å –∫ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É
suspend fun getCachedTrackPath(trackId: Int): String?

// –£–¥–∞–ª–∏—Ç—å —Ç—Ä–µ–∫ –∏–∑ –∫–µ—à–∞
suspend fun removeCachedTrack(trackId: Int): Result<Unit>

// –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à
suspend fun clearCache(): Result<Unit>

// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
suspend fun getCacheStats(): CacheStats
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `MAX_CACHE_SIZE_MB = 500` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–µ—à–∞ (500 –ú–ë)
- `CACHE_DIR_NAME = "music_cache"` - –ø–∞–ø–∫–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç—Ä–µ–∫–æ–≤

### 4. UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### TrackCacheState (enum)
–¢—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–µ—à–∞ —Ç—Ä–µ–∫–∞:
- `NOT_CACHED` - –Ω–µ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–∫–æ–Ω–∫–∞ –æ–±–ª–∞–∫–∞)
- `DOWNLOADING` - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–µ—Å—Å)
- `CACHED` - –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≥–∞–ª–æ—á–∫–∞)

#### TrackItemCompact
–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:

```kotlin
@Composable
fun TrackItemCompact(
    track: Track,
    isPlaying: Boolean,
    onPlayPause: () -> Unit,
    onClick: () -> Unit,
    grayText: Color,
    cacheState: TrackCacheState = TrackCacheState.NOT_CACHED,
    onCacheClick: (() -> Unit)? = null
)
```

**–ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `cacheState` - —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–µ—à–∞
- `onCacheClick` - –∫–æ–ª–±—ç–∫ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∏–∫–æ–Ω–∫—É –∫–µ—à–∞

**–ò–∫–æ–Ω–∫–∏:**
- `CloudDownload` - –Ω–µ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω (—Ü–≤–µ—Ç 0xFFE0E0E0)
- `CircularProgressIndicator` - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- `Check` - –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω

### 5. PlaylistViewModel

**–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
```kotlin
// –ó–∞–∫–µ—à–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–∫
fun cacheTrack(track: Track)

// –£–¥–∞–ª–∏—Ç—å —Ç—Ä–µ–∫ –∏–∑ –∫–µ—à–∞
fun removeCachedTrack(trackId: Int)

// –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–µ—à–∞ –¥–ª—è —Ç—Ä–µ–∫–∞
fun getTrackCacheState(trackId: Int): TrackCacheState
```

**–ù–æ–≤—ã–π StateFlow:**
```kotlin
val trackCacheStates: StateFlow<Map<Int, TrackCacheState>>
```

### 6. PlaylistSheet

–û–±–Ω–æ–≤–ª—ë–Ω –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:
```kotlin
items(filteredTracks, key = { it.id }) { track ->
    val cacheState = trackCacheStates[track.id] ?: TrackCacheState.NOT_CACHED
    
    TrackItemCompact(
        track = track,
        cacheState = cacheState,
        onCacheClick = {
            when (cacheState) {
                TrackCacheState.NOT_CACHED -> viewModel.cacheTrack(track)
                TrackCacheState.CACHED -> viewModel.removeCachedTrack(track.id)
                TrackCacheState.DOWNLOADING -> { /* –Ω–∏—á–µ–≥–æ */ }
            }
        }
    )
}
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–∞
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –Ω–∞ –∏–∫–æ–Ω–∫—É –æ–±–ª–∞–∫–∞
          ‚Üì
TrackItemCompact ‚Üí onCacheClick()
          ‚Üì
PlaylistViewModel.cacheTrack(track)
          ‚Üì
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ DOWNLOADING
          ‚Üì
TrackCacheRepository.cacheTrack()
          ‚Üì
‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–µ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω –ª–∏ —É–∂–µ
‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ music_cache
‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –∫–µ—à–∞
‚Ä¢ HTTP-–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
‚Ä¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ Room DB
          ‚Üì
–°–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ CACHED
```

### 2. –£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –Ω–∞ –≥–∞–ª–æ—á–∫—É
          ‚Üì
PlaylistViewModel.removeCachedTrack(trackId)
          ‚Üì
TrackCacheRepository.removeCachedTrack()
          ‚Üì
‚Ä¢ –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–∑ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
‚Ä¢ –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –∏–∑ Room DB
          ‚Üì
–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è (NOT_CACHED)
```

### 3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π
```
PlaylistViewModel.init()
          ‚Üì
loadCacheStates()
          ‚Üì
trackCacheRepository.getAllCachedTracks().collect { ... }
          ‚Üì
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ trackCacheStates
          ‚Üì
UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ —á–µ—Ä–µ–∑ collectAsState()
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ú–∏–≥—Ä–∞—Ü–∏—è
–í–µ—Ä—Å–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å **7 ‚Üí 8**:
```kotlin
@Database(
    entities = [
        ReminderEntity::class,
        ChatMessageEntity::class,
        MemoryEntity::class,
        CareBankEntity::class,
        TrackCacheEntity::class  // ‚Üê –¥–æ–±–∞–≤–ª–µ–Ω–æ
    ],
    version = 8,  // ‚Üê –æ–±–Ω–æ–≤–ª–µ–Ω–æ
    exportSchema = false
)
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `fallbackToDestructiveMigration()`, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏ –ë–î –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω—ã.

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–º –∫–µ—à–∞

### –õ–∏–º–∏—Ç—ã
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: **500 –ú–ë**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞: TODO (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```kotlin
val stats = trackCacheRepository.getCacheStats()
println("–¢—Ä–µ–∫–æ–≤: ${stats.tracksCount}")
println("–†–∞–∑–º–µ—Ä: ${stats.totalSizeMB} MB")
```

### –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –∫–µ—à–∞
```kotlin
trackCacheRepository.clearCache()
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö

### –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```kotlin
val database = AppDatabase.getDatabase(context)
val trackCacheRepository = TrackCacheRepository(
    trackCacheDao = database.trackCacheDao(),
    context = context
)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞ –ø–µ—Ä–µ–¥ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º
```kotlin
val cachedPath = trackCacheRepository.getCachedTrackPath(trackId)
if (cachedPath != null) {
    // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
    audioPlayer.playFromFile(cachedPath)
} else {
    // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å —Å–æ —Å—Ç—Ä–∏–º–∞
    audioPlayer.playFromUrl(streamUrl)
}
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ
- [x] Room entity –∏ DAO
- [x] –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –∑–∞–≥—Ä—É–∑–∫–æ–π/—É–¥–∞–ª–µ–Ω–∏–µ–º
- [x] UI —Å —Ç—Ä–µ–º—è —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ (–Ω–µ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω/–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è/–∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω)
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PlaylistViewModel
- [x] –†–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —á–µ—Ä–µ–∑ Flow
- [x] –ò–∫–æ–Ω–∫–∏ —Å —Ü–≤–µ—Ç–æ–º 0xFFE0E0E0

### üöß TODO (–±—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è)
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ç—Ä–µ–∫–æ–≤ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞
- [ ] –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∏–∑ –∫–µ—à–∞ –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–∏–º–∞
- [ ] –§–æ–Ω–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (WorkManager)
- [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–∑–º–µ—Ä–∞ –∫–µ—à–∞
- [ ] –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤

## –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞

–í—Å–µ –∏–∫–æ–Ω–∫–∏ –∫–µ—à–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—ã–π —Ü–≤–µ—Ç:
```kotlin
val arrowColor = Color(0xFFE0E0E0)  // –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π
```

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º UI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —Ç–µ–≥–æ–º `TrackCacheRepository`:
```
üéµ –ù–∞—á–∏–Ω–∞–µ–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞: Track Name
üì• –ó–∞–≥—Ä—É–∂–∞–µ–º —Å: http://server/path/to/track.mp3
‚úÖ –¢—Ä–µ–∫ —É—Å–ø–µ—à–Ω–æ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω: Track Name (1234 KB)
üóëÔ∏è –¢—Ä–µ–∫ —É–¥–∞–ª–µ–Ω –∏–∑ –∫–µ—à–∞: Track Name
‚ùå –û—à–∏–±–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–µ–∫–∞: ...
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```kotlin
// –í PlaylistViewModel
Log.d(TAG, "–°–æ—Å—Ç–æ—è–Ω–∏—è –∫–µ—à–∞: ${_trackCacheStates.value}")

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
val count = trackCacheDao.getCachedCount()
val size = trackCacheDao.getTotalCacheSize()
Log.d(TAG, "–ö–µ—à–∏—Ä–æ–≤–∞–Ω–æ —Ç—Ä–µ–∫–æ–≤: $count, —Ä–∞–∑–º–µ—Ä: ${size / 1024 / 1024} MB")
```

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** `TrackCacheRepository` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∫–∞–∫ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä (`null` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), —á—Ç–æ–±—ã —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å.

2. **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤:** –°–∏—Å—Ç–µ–º–∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π.

3. **–°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏:** –ü—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–∫ –ø—Ä–æ—Å—Ç–æ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–µ—à, –Ω–æ –Ω–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫.

4. **–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è destructive migration, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –§–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `context.cacheDir`, —á—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –º–µ—Å—Ç–∞
- HTTP-–∫–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∞–π–º–∞—É—Ç—ã (30 —Å–µ–∫—É–Ω–¥)
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ñ–æ–Ω–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö (Dispatchers.IO)

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Flow –¥–ª—è —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (–Ω–µ –ø–µ—Ä–µ–∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è –ë–î)
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ IO-–ø–æ—Ç–æ–∫–∞—Ö
- UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–µ—à–∞

